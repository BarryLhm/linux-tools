#!/bin/bash
set -eu

echo 'Reading token file...'
tokenfile='/usr/local/dynv6-token'
IFS=' '
read -r < "$tokenfile" zone interval token none

echo 'Entering loop...'
while true; do
    echo 'Fetching IP address...'
    ipv4="$(curl --connect-timeout 3 -m 3 ifconfig.me)"
    ipv6=6to4
    ipv6prefix=6to4
    echo 'Sending request...'
    curl --connect-timeout 3 -m 3 'https://dynv6.com/api/update?zone='"$zone"'&token='"$token"'&ipv4='"$ipv4"'&ipv6='"$ipv6"'&ipv6prefix='"$ipv6prefix"
    sleep "$interval"
done
